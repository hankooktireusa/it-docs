---
layout: default
title: ðŸ“‘ Failover Deployments
permalink: /en/web/proposals/failover-deployments/
---

<link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}">
{% include lang-toggle.html %}

<h1>ðŸ“‘ Failover Deployments</h1>
<p>Weighted ALB target group routing to enable zero-downtime prod1â†”prod2 cutovers.</p>

<hr />

<h2>ðŸŽ¯ Goal</h2>
<ul>
  <li>Send 100% traffic to <strong>prod1</strong> while deploying to <strong>prod2</strong>.</li>
  <li>Gradually shift traffic back to <strong>prod2</strong> (e.g., 10% â†’ 25% â†’ 50% â†’ 100%).</li>
  <li>Flip roles on the next deployment cycle (prod2 live, deploy to prod1).</li>
  <li>Return to even split after validation.</li>
  <li>Done by converting Listener forwarding actions to <strong>Weighted Target Groups</strong> in the ALB.</li>
</ul>

<hr />

<details>
  <summary>ðŸ›  STEP-BY-STEP PLAN (AWS Console)</summary>
  <div>

    <h3>1) Inspect Current Listener Rules</h3>
    <ul>
      <li>AWS Console â†’ <strong>EC2 â†’ Load Balancers</strong></li>
      <li>Select the <strong>ALB</strong> â†’ <strong>Listeners</strong> tab â†’ click <strong>:443</strong></li>
      <li>Review rules that match host/path â†’ forward to <code>-web-tg</code> or <code>-portal-tg</code>.</li>
    </ul>

    <hr />

    <h3>2) Convert Fixed Rule â†’ Weighted Target Groups</h3>
    <p><strong>Goal:</strong> Forward to both prod1 &amp; prod2 target groups with adjustable weights.</p>

    <p><strong>Example target groups:</strong></p>
    <ul>
      <li><code>hankooktire-us-prd-&lt;web|portal&gt;-01-tg</code> (prod1)</li>
      <li><code>hankooktire-us-prd-&lt;web|portal&gt;-02-tg</code> (prod2)</li>
    </ul>

    <p><strong>How:</strong></p>
    <ol>
      <li>Edit the rule.</li>
      <li>Choose <strong>Forward to â†’ Weighted target groups</strong>.</li>
      <li>Add both TGs with initial weights:
        <ul>
          <li><code>...-01-tg</code> â†’ <strong>100</strong></li>
          <li><code>...-02-tg</code> â†’ <strong>0</strong></li>
        </ul>
      </li>
      <li>Save.</li>
    </ol>

    <hr />

    <h3>3) Validate 100% on prod1</h3>
    <ul>
      <li>All HTTPS traffic should hit <strong>prod1</strong>.</li>
      <li><strong>prod2</strong> is idle and safe to deploy.</li>
      <li>Deploy to prod2 (<code>...-02-tg</code> instances).</li>
    </ul>

    <hr />

    <h3>4) Gradual Traffic Shift to prod2</h3>
    <ol>
      <li>Return to the Listener rule.</li>
      <li>Adjust weights through stages, testing at each step:
        <ul>
          <li>90/10 â†’ 75/25 â†’ 50/50 â†’ 25/75 â†’ 0/100 (or your chosen cadence).</li>
        </ul>
      </li>
      <li>Validate app behavior each step.</li>
      <li>Monitor <strong>CloudWatch</strong> metrics (TG health, latency, 4xx/5xx).</li>
    </ol>

    <hr />

    <h3>5) Flip for Next Deployment</h3>
    <ol>
      <li>Set <strong>prod1 TG</strong> weight to <strong>0</strong>.</li>
      <li>Deploy.</li>
      <li>Ramp back to <strong>100</strong>.</li>
      <li>Monitor, test, and finalize.</li>
    </ol>

  </div>
</details>

<hr />

<details>
  <summary>ðŸ“Œ Things to Note</summary>
  <div>
    <ul>
      <li>No additional AWS services or cost changes.</li>
      <li>Zero-downtime approach: weight <code>0</code> stops <strong>new</strong> connections but lets existing ones complete.</li>
      <li>TG stickiness is <strong>off</strong>, so sessions wonâ€™t cling to the old TG during ramp.</li>
      <li>Our broader deployment process remains unchanged.</li>
      <li>Coordinate with the team when performing a failover deployment.</li>
      <li><strong>Dev ALB</strong> currently doesnâ€™t mirror this setup:
        <ul>
          <li>Best practice: replicate weighted rules in <strong>dev</strong> and trial there first.</li>
        </ul>
      </li>
    </ul>
  </div>
</details>
